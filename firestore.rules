rules_version='2'

service cloud.firestore {
  match /databases/{database}/documents {
    // Memories collection - allow reading all memories
    // Client-side code filters what's displayed:
    // - Public users only see approved (filtered in Memories.tsx)
    // - Admins see all (pending, rejected, approved) in ApproveMemories.tsx
    match /memories/{memoryId} {
      // Allow reading all memories (pending, rejected, approved)
      // The client-side code handles filtering for public vs admin views
      allow read: if true;
      
      // Only backend (via cloud functions) can write
      // Client-side writes are disabled for security
      allow write: if false;
    }
    
    // Users collection - allow reading (admin dashboard is protected by route guards)
    // Passwords are excluded in the UserManagement component
    // Writes are only allowed via backend cloud functions
    match /users/{userId} {
      // Allow reading users (for admin dashboard)
      // The admin dashboard route is protected, and passwords are excluded client-side
      allow read: if true;
      
      // Only backend (via cloud functions) can write
      allow write: if false;
    }
    
    // Deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
